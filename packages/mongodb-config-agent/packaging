set -e

cp common/* ${BOSH_INSTALL_TARGET}

export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export GOPATH=${BOSH_COMPILE_TARGET}/go
export PATH=${GOROOT}/bin:${PATH}

mkdir -p ${BOSH_COMPILE_TARGET}/go/src/github.com/cf-platform-eng/mongodb-on-demand-release/src ${BOSH_INSTALL_TARGET}/bin
mv ${BOSH_COMPILE_TARGET}/mongodb-config-agent ${BOSH_COMPILE_TARGET}/go/src/github.com/cf-platform-eng/mongodb-on-demand-release/src
mv ${BOSH_COMPILE_TARGET}/mongodb-service-adapter ${BOSH_COMPILE_TARGET}/go/src/github.com/cf-platform-eng/mongodb-on-demand-release/src
go build -o "$BOSH_INSTALL_TARGET/bin/mongodb-config-agent" github.com/cf-platform-eng/mongodb-on-demand-release/src/mongodb-config-agent
