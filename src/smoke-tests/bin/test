#!/bin/bash

set -e
set -x

go install -v github.com/10gen/ops-manager-cloudfoundry/src/smoke-tests/vendor/github.com/onsi/ginkgo/ginkgo

export GOPATH=$GOPATH:$(pwd)

sudo mkdir -p /data/db
sudo service mongodb start
SERVICE=mongo
if P=$(pgrep $SERVICE)
then
   echo "$SERVICE is running, PID is $P"
else
   echo "$SERVICE is not running, installing mongodb"
   echo yes |  sudo apt install -y mongodb
   sudo service mongodb start
fi
sudo mongod --port 28000 --dbpath /data/db # yes ""

CF_COLOR=false CF_VERBOSE_OUTPUT=true ginkgo -r -v -noColor=true -keepGoing=true -trace=true -slowSpecThreshold=300 service adapter digest
